<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#000000">
<title>Rotograma – Câmera Full + Mapa + GPX/KMZ</title>
<link rel="manifest" href="manifest.webmanifest">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<!-- Utilitários -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
:root {
  color-scheme: dark;
  --bg:#000;
  --panel:rgba(20,20,20,.7);
  --text:#fff;
  --accent:#22c55e;
  --muted:#94a3b8;
}
* { box-sizing: border-box; }
html, body { margin:0; height:100%; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; }

/* Fullscreen camera layout */
.shell {
  position: fixed; inset: 0; width: 100vw; height: 100vh; overflow: hidden;
  background: #000;
}
video#camVideo {
  position:absolute; inset:0;
  width:100%; height:100%; object-fit:cover;
}

/* Overlay controls */
.ui {
  position:absolute; inset:0; pointer-events:none;
  display:flex; flex-direction:column; justify-content:space-between;
}
.topbar, .bottombar {
  display:flex; gap:8px; align-items:center; justify-content:space-between;
  padding:12px; pointer-events:auto;
}
.topbar { background: linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,0)); }
.bottombar { background: linear-gradient(0deg, rgba(0,0,0,.6), rgba(0,0,0,0)); }

.btns { display:flex; gap:8px; flex-wrap:wrap; }

button {
  background: var(--panel);
  color: var(--text);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 12px;
  padding: 10px 14px;
  font-weight: 700; letter-spacing:.2px;
  cursor: pointer;
  backdrop-filter: blur(6px);
}
button.primary { border-color: var(--accent); }
button:disabled { opacity:.5; cursor:not-allowed; }

/* Inset mini map over video */
#miniMapWrap {
  position:absolute; bottom:90px; right:12px; width: 180px; height: 180px;
  border-radius: 12px; overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.12);
}
#miniMap { width: 100%; height: 100%; }

/* Event thumbs tray (optional) */
#tray {
  position:absolute; left:12px; bottom:90px; display:flex; gap:8px; flex-wrap:wrap; max-width:60vw;
}
.thumb {
  width: 96px; height: 54px; object-fit: cover; border-radius: 8px; border:1px solid rgba(255,255,255,.15);
}

/* Watermark & status */
.status { font-size:12px; color:var(--muted); padding-left:8px; }
.brand { font-weight:800; }
</style>
</head>
<body>
<div class="shell">
  <video id="camVideo" autoplay muted playsinline></video>
  <div class="ui">
    <div class="topbar">
      <div>
        <div class="brand">Rotograma</div>
        <div class="status" id="gpsStatus">GPS: aguardando…</div>
      </div>
      <div class="btns">
        <button id="toggleMapBtn">Mostrar/Ocultar Mapa</button>
        <button id="captureBtn" class="primary">Capturar Foto (com mapa)</button>
      </div>
    </div>

    <div id="tray"></div>

    <div class="bottombar">
      <div class="btns">
        <button id="startRecBtn" class="primary">Iniciar Gravação</button>
        <button id="stopRecBtn" disabled>Parar Gravação</button>
        <button id="exportGpxBtn">Exportar GPX</button>
        <button id="exportKmzBtn">Exportar KMZ</button>
        <button id="exportPdfBtn">Gerar PDF</button>
      </div>
      <div class="status" id="recStatus">Vídeo: parado • Trilhas: 0 pts</div>
    </div>
  </div>

  <div id="miniMapWrap">
    <div id="miniMap"></div>
  </div>
</div>

<script src="app.js"></script>
<script>
// PWA - SW
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js');
  });
}
</script>
</body>
</html>
